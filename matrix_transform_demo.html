<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŸ©é˜µå˜æ¢è¯¦è§£ - åæ ‡è½¬æ¢æ¼”ç¤º</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .code-explanation {
            background: #f8f9fa;
            border-left: 5px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .code-explanation h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
            position: relative;
        }
        
        .code-line {
            margin: 8px 0;
            padding: 5px;
            border-left: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .code-line:hover {
            background: #3d3d3d;
            border-left-color: #667eea;
        }
        
        .line-number {
            color: #858585;
            margin-right: 15px;
            display: inline-block;
            width: 30px;
        }
        
        .highlight {
            background: rgba(102, 126, 234, 0.2);
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .explanation-item {
            margin: 20px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .explanation-item h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        .explanation-item p {
            line-height: 1.8;
            color: #555;
        }
        
        .formula {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            text-align: center;
            font-size: 1.2em;
            font-family: 'Courier New', monospace;
        }
        
        .canvas-container {
            width: 100%;
            height: 600px;
            background: #1a1a1a;
            border-radius: 10px;
            margin: 30px 0;
            position: relative;
            overflow: hidden;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .control-group {
            flex: 1;
            min-width: 200px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #667eea;
        }
        
        .control-group input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }
        
        .control-group .value-display {
            text-align: center;
            font-family: monospace;
            color: #666;
            font-size: 0.9em;
        }
        
        .info-panel {
            background: #e7f3ff;
            border: 2px solid #2196F3;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .info-panel h3 {
            color: #2196F3;
            margin-bottom: 15px;
        }
        
        .info-panel table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .info-panel table th,
        .info-panel table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .info-panel table th {
            background: #2196F3;
            color: white;
        }
        
        .step-by-step {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #667eea;
        }
        
        .step {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            border-radius: 5px;
        }
        
        .step-number {
            display: inline-block;
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”¢ çŸ©é˜µå˜æ¢è¯¦è§£</h1>
        <p class="subtitle">åæ ‡è½¬æ¢ä¸­çš„çŸ©é˜µè¿ç®—åŸç†ä¸å¯è§†åŒ–æ¼”ç¤º</p>
        
        <div class="code-explanation">
            <h2>ğŸ“ ä»£ç è§£æ (ç¬¬186-189è¡Œ)</h2>
            <div class="code-block">
                <div class="code-line">
                    <span class="line-number">186</span>
                    <span class="highlight">const initialMatrixInverse = new Matrix4();</span>
                </div>
                <div class="code-line">
                    <span class="line-number">187</span>
                    <span class="highlight">initialMatrixInverse.copy(initialMatrix).invert();</span>
                </div>
                <div class="code-line">
                    <span class="line-number">188</span>
                    <span class="highlight">const transformMatrix = new Matrix4();</span>
                </div>
                <div class="code-line">
                    <span class="line-number">189</span>
                    <span class="highlight">transformMatrix.multiplyMatrices(currentMatrix, initialMatrixInverse);</span>
                </div>
            </div>
        </div>
        
        <div class="step-by-step">
            <h2>ğŸ” é€æ­¥è§£æ</h2>
            
            <div class="step">
                <span class="step-number">1</span>
                <strong>ç¬¬186è¡Œï¼šåˆ›å»ºé€†çŸ©é˜µå¯¹è±¡</strong>
                <p>åˆ›å»ºä¸€ä¸ªæ–°çš„ 4x4 çŸ©é˜µå¯¹è±¡ï¼Œç”¨äºå­˜å‚¨åˆå§‹çŸ©é˜µçš„é€†çŸ©é˜µã€‚Matrix4 æ˜¯ Three.js ä¸­è¡¨ç¤º 4x4 å˜æ¢çŸ©é˜µçš„ç±»ï¼Œç”¨äºæè¿°ä¸‰ç»´ç©ºé—´ä¸­çš„å¹³ç§»ã€æ—‹è½¬å’Œç¼©æ”¾å˜æ¢ã€‚</p>
            </div>
            
            <div class="step">
                <span class="step-number">2</span>
                <strong>ç¬¬187è¡Œï¼šè®¡ç®—åˆå§‹çŸ©é˜µçš„é€†çŸ©é˜µ</strong>
                <p>
                    <code>copy(initialMatrix)</code> - å¤åˆ¶åˆå§‹çŠ¶æ€çŸ©é˜µ<br>
                    <code>.invert()</code> - è®¡ç®—é€†çŸ©é˜µ
                </p>
                <div class="formula">
                    å¦‚æœ M æ˜¯åˆå§‹çŸ©é˜µï¼Œåˆ™ Mâ»Â¹ æ»¡è¶³ï¼šM Ã— Mâ»Â¹ = Iï¼ˆå•ä½çŸ©é˜µï¼‰
                </div>
                <p><strong>å«ä¹‰ï¼š</strong>é€†çŸ©é˜µèƒ½å¤Ÿ"æ’¤é”€"åŸå§‹å˜æ¢ã€‚å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªç‚¹ P' = M Ã— Pï¼ˆåˆå§‹çŸ©é˜µå˜æ¢åçš„ç‚¹ï¼‰ï¼Œé‚£ä¹ˆ P = Mâ»Â¹ Ã— P'ï¼ˆé€šè¿‡é€†çŸ©é˜µå¯ä»¥è¿˜åŸå›åŸå§‹ç‚¹ï¼‰ã€‚</p>
            </div>
            
            <div class="step">
                <span class="step-number">3</span>
                <strong>ç¬¬188è¡Œï¼šåˆ›å»ºå˜æ¢çŸ©é˜µå¯¹è±¡</strong>
                <p>åˆ›å»ºä¸€ä¸ªæ–°çš„çŸ©é˜µå¯¹è±¡ï¼Œç”¨äºå­˜å‚¨ä»åˆå§‹çŠ¶æ€åˆ°å½“å‰çŠ¶æ€çš„å˜æ¢çŸ©é˜µã€‚è¿™ä¸ªçŸ©é˜µå°†å‘Šè¯‰æˆ‘ä»¬å¦‚ä½•å°†åˆå§‹çŠ¶æ€ä¸‹çš„ç‚¹è½¬æ¢åˆ°å½“å‰çŠ¶æ€ã€‚</p>
            </div>
            
            <div class="step">
                <span class="step-number">4</span>
                <strong>ç¬¬189è¡Œï¼šè®¡ç®—å˜æ¢çŸ©é˜µ</strong>
                <p>
                    <code>multiplyMatrices(currentMatrix, initialMatrixInverse)</code><br>
                    å°†å½“å‰çŸ©é˜µä¸åˆå§‹çŸ©é˜µçš„é€†çŸ©é˜µç›¸ä¹˜
                </p>
                <div class="formula">
                    transformMatrix = currentMatrix Ã— initialMatrixâ»Â¹
                </div>
                <p><strong>æ•°å­¦å«ä¹‰ï¼š</strong></p>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>å‡è®¾ç‚¹åœ¨åˆå§‹çŠ¶æ€ä¸‹çš„ä¸–ç•Œåæ ‡ä¸º P_initial</li>
                    <li>ç‚¹åœ¨å½“å‰çŠ¶æ€ä¸‹çš„ä¸–ç•Œåæ ‡ä¸º P_current</li>
                    <li>P_initial = initialMatrix Ã— P_localï¼ˆå±€éƒ¨åæ ‡è½¬åˆå§‹ä¸–ç•Œåæ ‡ï¼‰</li>
                    <li>P_current = currentMatrix Ã— P_localï¼ˆå±€éƒ¨åæ ‡è½¬å½“å‰ä¸–ç•Œåæ ‡ï¼‰</li>
                    <li>å› æ­¤ï¼šP_current = currentMatrix Ã— (initialMatrixâ»Â¹ Ã— P_initial)</li>
                    <li>å³ï¼šP_current = (currentMatrix Ã— initialMatrixâ»Â¹) Ã— P_initial</li>
                </ul>
                <p><strong>å®é™…æ•ˆæœï¼š</strong>è¿™ä¸ªå˜æ¢çŸ©é˜µå¯ä»¥ç›´æ¥å°†åˆå§‹çŠ¶æ€ä¸‹çš„ä¸–ç•Œåæ ‡ç‚¹è½¬æ¢ä¸ºå½“å‰çŠ¶æ€ä¸‹çš„ä¸–ç•Œåæ ‡ç‚¹ã€‚</p>
            </div>
        </div>
        
        <div class="info-panel">
            <h3>ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ</h3>
            <table>
                <tr>
                    <th>æ¦‚å¿µ</th>
                    <th>è¯´æ˜</th>
                </tr>
                <tr>
                    <td><strong>initialMatrix</strong></td>
                    <td>åˆå§‹çŠ¶æ€çš„å˜æ¢çŸ©é˜µï¼ˆåªåŒ…å«ä½ç½®å’Œç¼©æ”¾ï¼Œä¸å«æ—‹è½¬ï¼‰</td>
                </tr>
                <tr>
                    <td><strong>currentMatrix</strong></td>
                    <td>å½“å‰çŠ¶æ€çš„å˜æ¢çŸ©é˜µï¼ˆåŒ…å«ä½ç½®ã€æ—‹è½¬ã€ç¼©æ”¾ï¼‰</td>
                </tr>
                <tr>
                    <td><strong>initialMatrixâ»Â¹</strong></td>
                    <td>åˆå§‹çŸ©é˜µçš„é€†çŸ©é˜µï¼ˆç”¨äº"æ’¤é”€"åˆå§‹å˜æ¢ï¼‰</td>
                </tr>
                <tr>
                    <td><strong>transformMatrix</strong></td>
                    <td>ä»åˆå§‹çŠ¶æ€åˆ°å½“å‰çŠ¶æ€çš„å˜æ¢çŸ©é˜µï¼ˆæ ¸å¿ƒè½¬æ¢å…¬å¼ï¼‰</td>
                </tr>
            </table>
        </div>
        
        <div class="canvas-container" id="canvas-container"></div>
        
        <div class="controls">
            <div class="control-group">
                <label>æ—‹è½¬è§’åº¦ X (åº¦)</label>
                <input type="range" id="rotateX" min="0" max="360" value="0">
                <div class="value-display" id="rotateXValue">0Â°</div>
            </div>
            <div class="control-group">
                <label>æ—‹è½¬è§’åº¦ Y (åº¦)</label>
                <input type="range" id="rotateY" min="0" max="360" value="0">
                <div class="value-display" id="rotateYValue">0Â°</div>
            </div>
            <div class="control-group">
                <label>æ—‹è½¬è§’åº¦ Z (åº¦)</label>
                <input type="range" id="rotateZ" min="0" max="360" value="0">
                <div class="value-display" id="rotateZValue">0Â°</div>
            </div>
            <div class="control-group">
                <label>ç¼©æ”¾æ¯”ä¾‹</label>
                <input type="range" id="scale" min="0.5" max="2" step="0.1" value="1">
                <div class="value-display" id="scaleValue">1.0</div>
            </div>
        </div>
        
        <div class="info-panel">
            <h3>ğŸ“Š å®æ—¶çŸ©é˜µæ•°æ®</h3>
            <div id="matrix-info"></div>
        </div>
    </div>
    
    <script>
        // åœºæ™¯è®¾ç½®
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x1a1a1a);
        
        const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        const container = document.getElementById('canvas-container');
        renderer.setSize(container.offsetWidth, container.offsetHeight);
        container.appendChild(renderer.domElement);
        
        // ç›¸æœºä½ç½®
        camera.position.set(5, 5, 5);
        camera.lookAt(0, 0, 0);
        
        // æ·»åŠ ç½‘æ ¼
        const gridHelper = new THREE.GridHelper(10, 10, 0x444444, 0x222222);
        scene.add(gridHelper);
        
        // æ·»åŠ åæ ‡è½´
        const axesHelper = new THREE.AxesHelper(3);
        scene.add(axesHelper);
        
        // åˆå§‹çŠ¶æ€çš„å¯¹è±¡ï¼ˆç«‹æ–¹ä½“ï¼‰
        const initialGeometry = new THREE.BoxGeometry(1, 1, 1);
        const initialMaterial = new THREE.MeshBasicMaterial({ 
            color: 0x00ff00, 
            transparent: true, 
            opacity: 0.5,
            wireframe: true
        });
        const initialCube = new THREE.Mesh(initialGeometry, initialMaterial);
        initialCube.position.set(0, 0, 0);
        scene.add(initialCube);
        
        // å½“å‰çŠ¶æ€çš„å¯¹è±¡ï¼ˆç«‹æ–¹ä½“ï¼‰
        const currentGeometry = new THREE.BoxGeometry(1, 1, 1);
        const currentMaterial = new THREE.MeshBasicMaterial({ 
            color: 0xff6600,
            wireframe: true
        });
        const currentCube = new THREE.Mesh(currentGeometry, currentMaterial);
        currentCube.position.set(0, 0, 0);
        scene.add(currentCube);
        
        // æµ‹è¯•ç‚¹ï¼ˆåœ¨åˆå§‹çŠ¶æ€ä¸‹çš„åæ ‡ï¼‰
        const testPoints = [
            new THREE.Vector3(1, 0, 0),   // å³ä¾§ç‚¹
            new THREE.Vector3(0, 1, 0),   // ä¸Šæ–¹ç‚¹
            new THREE.Vector3(0, 0, 1),   // å‰æ–¹ç‚¹
            new THREE.Vector3(-1, 0, 0),  // å·¦ä¾§ç‚¹
            new THREE.Vector3(0, -1, 0),  // ä¸‹æ–¹ç‚¹
            new THREE.Vector3(0, 0, -1),  // åæ–¹ç‚¹
        ];
        
        // åˆå§‹çŠ¶æ€çš„ç‚¹ï¼ˆç»¿è‰²ï¼‰
        const initialPointSpheres = [];
        testPoints.forEach((point, index) => {
            const geometry = new THREE.SphereGeometry(0.1, 16, 16);
            const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
            const sphere = new THREE.Mesh(geometry, material);
            sphere.position.copy(point);
            scene.add(sphere);
            initialPointSpheres.push({ sphere, originalPoint: point.clone() });
        });
        
        // å˜æ¢åçš„ç‚¹ï¼ˆçº¢è‰²ï¼‰
        const transformedPointSpheres = [];
        testPoints.forEach((point, index) => {
            const geometry = new THREE.SphereGeometry(0.1, 16, 16);
            const material = new THREE.MeshBasicMaterial({ color: 0xff0000 });
            const sphere = new THREE.Mesh(geometry, material);
            scene.add(sphere);
            transformedPointSpheres.push({ sphere, originalPoint: point.clone() });
        });
        
        // è¿æ¥çº¿
        const lineMaterial = new THREE.LineBasicMaterial({ color: 0xffff00, linewidth: 2 });
        const lines = [];
        testPoints.forEach(() => {
            const geometry = new THREE.BufferGeometry();
            const line = new THREE.Line(geometry, lineMaterial);
            scene.add(line);
            lines.push(line);
        });
        
        // æ§åˆ¶æ»‘å—
        const rotateXSlider = document.getElementById('rotateX');
        const rotateYSlider = document.getElementById('rotateY');
        const rotateZSlider = document.getElementById('rotateZ');
        const scaleSlider = document.getElementById('scale');
        
        const rotateXValue = document.getElementById('rotateXValue');
        const rotateYValue = document.getElementById('rotateYValue');
        const rotateZValue = document.getElementById('rotateZValue');
        const scaleValue = document.getElementById('scaleValue');
        const matrixInfo = document.getElementById('matrix-info');
        
        // æ›´æ–°å‡½æ•°
        function update() {
            const rotX = (rotateXSlider.value / 180) * Math.PI;
            const rotY = (rotateYSlider.value / 180) * Math.PI;
            const rotZ = (rotateZSlider.value / 180) * Math.PI;
            const scale = parseFloat(scaleSlider.value);
            
            rotateXValue.textContent = rotateXSlider.value + 'Â°';
            rotateYValue.textContent = rotateYSlider.value + 'Â°';
            rotateZValue.textContent = rotateZSlider.value + 'Â°';
            scaleValue.textContent = scale.toFixed(1);
            
            // æ›´æ–°å½“å‰ç«‹æ–¹ä½“çš„å˜æ¢
            currentCube.rotation.set(rotX, rotY, rotZ);
            currentCube.scale.set(scale, scale, scale);
            currentCube.updateMatrixWorld();
            
            // === æ ¸å¿ƒä»£ç é€»è¾‘ ===
            // 1. æ„å»ºåˆå§‹çŠ¶æ€çŸ©é˜µï¼ˆæ— æ—‹è½¬ï¼Œåªæœ‰ä½ç½®å’Œç¼©æ”¾ï¼‰
            const initialTransform = {
                position: new THREE.Vector3(0, 0, 0),
                quaternion: new THREE.Quaternion(),
                scale: new THREE.Vector3(1, 1, 1)
            };
            
            const initialMatrix = new THREE.Matrix4();
            initialMatrix.compose(
                initialTransform.position,
                initialTransform.quaternion, // æ— æ—‹è½¬
                initialTransform.scale
            );
            
            // 2. æ„å»ºå½“å‰çŠ¶æ€çŸ©é˜µï¼ˆåŒ…å«æ—‹è½¬å’Œç¼©æ”¾ï¼‰
            const currentMatrix = new THREE.Matrix4();
            currentMatrix.compose(
                currentCube.position,
                new THREE.Quaternion().setFromEuler(currentCube.rotation),
                currentCube.scale
            );
            
            // 3. è®¡ç®—é€†çŸ©é˜µï¼ˆç¬¬186-187è¡Œï¼‰
            const initialMatrixInverse = new THREE.Matrix4();
            initialMatrixInverse.copy(initialMatrix).invert();
            
            // 4. è®¡ç®—å˜æ¢çŸ©é˜µï¼ˆç¬¬188-189è¡Œï¼‰
            const transformMatrix = new THREE.Matrix4();
            transformMatrix.multiplyMatrices(currentMatrix, initialMatrixInverse);
            
            // === åº”ç”¨å˜æ¢åˆ°ç‚¹ ===
            testPoints.forEach((point, index) => {
                // åˆå§‹çŠ¶æ€çš„ç‚¹ï¼ˆç»¿è‰²ï¼‰
                initialPointSpheres[index].sphere.position.copy(point);
                
                // ä½¿ç”¨å˜æ¢çŸ©é˜µè½¬æ¢ç‚¹ï¼ˆçº¢è‰²ï¼‰
                const transformedPoint = point.clone().applyMatrix4(transformMatrix);
                transformedPointSpheres[index].sphere.position.copy(transformedPoint);
                
                // ç»˜åˆ¶è¿æ¥çº¿
                const lineGeometry = new THREE.BufferGeometry().setFromPoints([
                    point,
                    transformedPoint
                ]);
                lines[index].geometry.dispose();
                lines[index].geometry = lineGeometry;
            });
            
            // æ˜¾ç¤ºçŸ©é˜µä¿¡æ¯
            displayMatrixInfo(initialMatrix, currentMatrix, initialMatrixInverse, transformMatrix);
        }
        
        function displayMatrixInfo(initialMatrix, currentMatrix, initialMatrixInverse, transformMatrix) {
            function formatMatrix(matrix, name) {
                const elements = matrix.elements;
                return `
                    <h4 style="color: #667eea; margin-top: 15px;">${name}</h4>
                    <table style="width: 100%; border-collapse: collapse; margin: 10px 0;">
                        <tr>
                            <td style="padding: 5px; font-family: monospace; background: #f0f0f0;">${elements[0].toFixed(3)}</td>
                            <td style="padding: 5px; font-family: monospace; background: #f0f0f0;">${elements[4].toFixed(3)}</td>
                            <td style="padding: 5px; font-family: monospace; background: #f0f0f0;">${elements[8].toFixed(3)}</td>
                            <td style="padding: 5px; font-family: monospace; background: #f0f0f0;">${elements[12].toFixed(3)}</td>
                        </tr>
                        <tr>
                            <td style="padding: 5px; font-family: monospace; background: #f0f0f0;">${elements[1].toFixed(3)}</td>
                            <td style="padding: 5px; font-family: monospace; background: #f0f0f0;">${elements[5].toFixed(3)}</td>
                            <td style="padding: 5px; font-family: monospace; background: #f0f0f0;">${elements[9].toFixed(3)}</td>
                            <td style="padding: 5px; font-family: monospace; background: #f0f0f0;">${elements[13].toFixed(3)}</td>
                        </tr>
                        <tr>
                            <td style="padding: 5px; font-family: monospace; background: #f0f0f0;">${elements[2].toFixed(3)}</td>
                            <td style="padding: 5px; font-family: monospace; background: #f0f0f0;">${elements[6].toFixed(3)}</td>
                            <td style="padding: 5px; font-family: monospace; background: #f0f0f0;">${elements[10].toFixed(3)}</td>
                            <td style="padding: 5px; font-family: monospace; background: #f0f0f0;">${elements[14].toFixed(3)}</td>
                        </tr>
                        <tr>
                            <td style="padding: 5px; font-family: monospace; background: #f0f0f0;">${elements[3].toFixed(3)}</td>
                            <td style="padding: 5px; font-family: monospace; background: #f0f0f0;">${elements[7].toFixed(3)}</td>
                            <td style="padding: 5px; font-family: monospace; background: #f0f0f0;">${elements[11].toFixed(3)}</td>
                            <td style="padding: 5px; font-family: monospace; background: #f0f0f0;">${elements[15].toFixed(3)}</td>
                        </tr>
                    </table>
                `;
            }
            
            matrixInfo.innerHTML = `
                ${formatMatrix(initialMatrix, 'Initial Matrix (åˆå§‹çŸ©é˜µ)')}
                ${formatMatrix(currentMatrix, 'Current Matrix (å½“å‰çŸ©é˜µ)')}
                ${formatMatrix(initialMatrixInverse, 'Initial Matrixâ»Â¹ (åˆå§‹çŸ©é˜µçš„é€†)')}
                ${formatMatrix(transformMatrix, 'Transform Matrix (å˜æ¢çŸ©é˜µ) = Current Ã— Initialâ»Â¹')}
                <p style="margin-top: 15px; color: #666;">
                    <strong>è¯´æ˜ï¼š</strong>ç»¿è‰²çƒä½“æ˜¯åˆå§‹çŠ¶æ€çš„ç‚¹ï¼Œçº¢è‰²çƒä½“æ˜¯é€šè¿‡å˜æ¢çŸ©é˜µè½¬æ¢åçš„ç‚¹ã€‚
                    é»„è‰²çº¿æ¡è¿æ¥å¯¹åº”çš„ç‚¹ï¼Œå±•ç¤ºå˜æ¢çš„æ•ˆæœã€‚
                </p>
            `;
        }
        
        // äº‹ä»¶ç›‘å¬
        rotateXSlider.addEventListener('input', update);
        rotateYSlider.addEventListener('input', update);
        rotateZSlider.addEventListener('input', update);
        scaleSlider.addEventListener('input', update);
        
        // é¼ æ ‡æ§åˆ¶
        let isDragging = false;
        let previousMousePosition = { x: 0, y: 0 };
        
        container.addEventListener('mousedown', (e) => {
            isDragging = true;
            previousMousePosition = { x: e.clientX, y: e.clientY };
        });
        
        container.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            
            const deltaX = e.clientX - previousMousePosition.x;
            const deltaY = e.clientY - previousMousePosition.y;
            
            const spherical = new THREE.Spherical();
            spherical.setFromVector3(camera.position);
            spherical.theta -= deltaX * 0.01;
            spherical.phi += deltaY * 0.01;
            spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, spherical.phi));
            
            camera.position.setFromSpherical(spherical);
            camera.lookAt(0, 0, 0);
            
            previousMousePosition = { x: e.clientX, y: e.clientY };
        });
        
        container.addEventListener('mouseup', () => {
            isDragging = false;
        });
        
        container.addEventListener('wheel', (e) => {
            e.preventDefault();
            const scale = e.deltaY > 0 ? 1.1 : 0.9;
            camera.position.multiplyScalar(scale);
        });
        
        // å“åº”å¼
        window.addEventListener('resize', () => {
            camera.aspect = container.offsetWidth / container.offsetHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.offsetWidth, container.offsetHeight);
        });
        
        // åŠ¨ç”»å¾ªç¯
        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }
        
        // åˆå§‹æ›´æ–°
        update();
        animate();
    </script>
</body>
</html>

